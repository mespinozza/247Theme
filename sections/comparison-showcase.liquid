{{ 'section-comparison-showcase.css' | asset_url | stylesheet_tag }}
<script src="{{ 'comparison-showcase.js' | asset_url }}" defer="defer"></script>

{% assign heading_rgb = section.settings['color-heading'] | color_to_rgb %}
{% assign background_rgb = section.settings['section-background-color'] | color_to_rgb %}
{% assign text_rgb = section.settings['color-body-text'] | color_to_rgb %}
{% assign accent_rgb = section.settings['accent-color'] | color_to_rgb %}

<style>
  section[id="shopify-section-{{ section.id }}"] {
    {% if background_rgb != 'rgba(0, 0, 0, 0.0)' %}
      --section-bg-color: {{ section.settings.section-background-color }};
      --section-bg-rgb: {{ section.settings.section-background-color | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    {% else %}
      --section-bg-color: var(--color-background);
      --section-bg-rgb: var(--color-background-rgb);
    {% endif %}

    {% if heading_rgb != 'rgba(0, 0, 0, 0.0)' %}
      --heading-color: {{ section.settings.color-heading }};
    {% else %}
      --heading-color: var(--color-foreground);
    {% endif %}

    {% if text_rgb != 'rgba(0, 0, 0, 0.0)' %}
      --text-color: {{ section.settings.color-body-text }};
    {% else %}
      --text-color: var(--color-foreground);
    {% endif %}

    {% if accent_rgb != 'rgba(0, 0, 0, 0.0)' %}
      --accent-color: {{ section.settings.accent-color }};
    {% else %}
      --accent-color: var(--color-button-primary-background);
    {% endif %}

    {% if section.settings.margin-top %}
      --section-gap-top: {{ section.settings.margin-top }}px;
    {% endif %}

    {% if section.settings.margin-bottom %}
      --section-gap-bottom: {{ section.settings.margin-bottom }}px;
    {% endif %}

    --comparison-gap: {{ section.settings.comparison-gap | default: 24 }}px;
    --border-radius: {{ section.settings.block-border-radius | default: 12 }}px;
  }

  {%- for block in section.blocks -%}
  [data-block-id="{{ block.id }}"] {
    {% assign block_bg_rgb = block.settings['block-background-color'] | color_to_rgb %}
    {% if block_bg_rgb != 'rgba(0, 0, 0, 0.0)' %}
      --block-bg-color: {{ block.settings.block-background-color }};
    {% else %}
      --block-bg-color: var(--color-background);
    {% endif %}

    {% assign block_text_rgb = block.settings['block-text-color'] | color_to_rgb %}
    {% if block_text_rgb != 'rgba(0, 0, 0, 0.0)' %}
      --block-text-color: {{ block.settings.block-text-color }};
    {% else %}
      --block-text-color: var(--text-color);
    {% endif %}
  }
  {%- endfor -%}
</style>

{% if section.settings['full-width-enabled'] %}
  {% assign width_class = 'comparison-showcase__wrapper--full' %}
{% else %}
  {% assign width_class = 'comparison-showcase__wrapper' %}
{% endif %}

<div
  data-section-id="{{ section.id }}"
  class="comparison-showcase {{ width_class }} {% if settings.animations %} scroll-trigger animate--slide-in {% endif %} {% if settings.disabled_animations_on_mobile %} disabled-on-mobile {% endif %}"
>
  {% if section.settings.heading != blank %}
    {% render 'headline', title: section.settings.heading %}
  {% endif %}

  {% if section.settings.subheading != blank %}
    <div class="comparison-showcase__subheading">
      {{ section.settings.subheading }}
    </div>
  {% endif %}

  <div class="{% if settings.animations %} scroll-trigger animate--slide-in {% endif %} {% if settings.disabled_animations_on_mobile %} disabled-on-mobile {% endif %}">
    
    <!-- Desktop Side-by-Side Layout -->
    <div class="comparison-showcase__desktop desktop-only">
      <div class="comparison-showcase__container" data-comparison-container>
        {% assign comparison_a_block = blank %}
        {% assign comparison_b_block = blank %}
        
        {% for block in section.blocks %}
          {% if block.type == 'comparison_a' %}
            {% assign comparison_a_block = block %}
          {% elsif block.type == 'comparison_b' %}
            {% assign comparison_b_block = block %}
          {% endif %}
        {% endfor %}

        {% if comparison_a_block %}
          <div 
            class="comparison-showcase__block comparison-showcase__block--a"
            data-block-id="{{ comparison_a_block.id }}"
            data-comparison-side="a"
            {{ comparison_a_block.shopify_attributes }}
          >
            <div class="comparison-showcase__block-content">
              {% if comparison_a_block.settings.icon_image %}
                <div class="comparison-showcase__icon">
                  {{ comparison_a_block.settings.icon_image | image_tag: loading: 'lazy', width: 64, height: 64 }}
                </div>
              {% endif %}

              {% if comparison_a_block.settings.heading != blank %}
                <h3 class="comparison-showcase__block-heading">
                  {{ comparison_a_block.settings.heading }}
                </h3>
              {% endif %}

              {% if comparison_a_block.settings.description != blank %}
                <div class="comparison-showcase__block-description rte">
                  {{ comparison_a_block.settings.description }}
                </div>
              {% endif %}

              {% if comparison_a_block.settings.features != blank %}
                <div class="comparison-showcase__block-features rte">
                  {{ comparison_a_block.settings.features }}
                </div>
              {% endif %}
            </div>
            <div class="comparison-showcase__hover-overlay"></div>
          </div>
        {% endif %}

        {% if comparison_b_block %}
          <div 
            class="comparison-showcase__block comparison-showcase__block--b"
            data-block-id="{{ comparison_b_block.id }}"
            data-comparison-side="b"
            {{ comparison_b_block.shopify_attributes }}
          >
            <div class="comparison-showcase__block-content">
              {% if comparison_b_block.settings.icon_image %}
                <div class="comparison-showcase__icon">
                  {{ comparison_b_block.settings.icon_image | image_tag: loading: 'lazy', width: 64, height: 64 }}
                </div>
              {% endif %}

              {% if comparison_b_block.settings.heading != blank %}
                <h3 class="comparison-showcase__block-heading">
                  {{ comparison_b_block.settings.heading }}
                </h3>
              {% endif %}

              {% if comparison_b_block.settings.description != blank %}
                <div class="comparison-showcase__block-description rte">
                  {{ comparison_b_block.settings.description }}
                </div>
              {% endif %}

              {% if comparison_b_block.settings.features != blank %}
                <div class="comparison-showcase__block-features rte">
                  {{ comparison_b_block.settings.features }}
                </div>
              {% endif %}
            </div>
            <div class="comparison-showcase__hover-overlay"></div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Mobile Stacked Toggle Layout -->
    <comparison-showcase class="comparison-showcase__mobile mobile-only">
      <div class="comparison-showcase__mobile-container">
        
        {% if comparison_a_block %}
          <div 
            class="comparison-showcase__mobile-block"
            data-block-id="{{ comparison_a_block.id }}"
            data-mobile-side="a"
            data-mobile-state="collapsed"
            {{ comparison_a_block.shopify_attributes }}
          >
            <div class="comparison-showcase__mobile-header" data-mobile-toggle>
              <h3 class="comparison-showcase__mobile-title">
                {{ comparison_a_block.settings.heading | default: 'Option A' }}
              </h3>
              <div class="comparison-showcase__mobile-icon">
                <svg class="comparison-showcase__expand-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M19 9L12 16L5 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>

            <div class="comparison-showcase__mobile-content">
              {% if comparison_a_block.settings.icon_image %}
                <div class="comparison-showcase__icon">
                  {{ comparison_a_block.settings.icon_image | image_tag: loading: 'lazy', width: 48, height: 48 }}
                </div>
              {% endif %}

              {% if comparison_a_block.settings.description != blank %}
                <div class="comparison-showcase__block-description rte">
                  {{ comparison_a_block.settings.description }}
                </div>
              {% endif %}

              {% if comparison_a_block.settings.features != blank %}
                <div class="comparison-showcase__block-features rte">
                  {{ comparison_a_block.settings.features }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        {% if comparison_b_block %}
          <div 
            class="comparison-showcase__mobile-block"
            data-block-id="{{ comparison_b_block.id }}"
            data-mobile-side="b"
            data-mobile-state="expanded"
            {{ comparison_b_block.shopify_attributes }}
          >
            <div class="comparison-showcase__mobile-header" data-mobile-toggle>
              <h3 class="comparison-showcase__mobile-title">
                {{ comparison_b_block.settings.heading | default: 'Option B' }}
              </h3>
              <div class="comparison-showcase__mobile-icon">
                <svg class="comparison-showcase__expand-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M19 9L12 16L5 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>

            <div class="comparison-showcase__mobile-content">
              {% if comparison_b_block.settings.icon_image %}
                <div class="comparison-showcase__icon">
                  {{ comparison_b_block.settings.icon_image | image_tag: loading: 'lazy', width: 48, height: 48 }}
                </div>
              {% endif %}

              {% if comparison_b_block.settings.description != blank %}
                <div class="comparison-showcase__block-description rte">
                  {{ comparison_b_block.settings.description }}
                </div>
              {% endif %}

              {% if comparison_b_block.settings.features != blank %}
                <div class="comparison-showcase__block-features rte">
                  {{ comparison_b_block.settings.features }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endif %}

      </div>
    </comparison-showcase>

  </div>
</div>

{% schema %}
{
  "name": "Comparison Showcase",
  "tag": "section",
  "class": "section-comparison-showcase",
  "max_blocks": 2,
  "settings": [
    {
      "type": "header",
      "content": "General"
    },
    {
      "type": "textarea",
      "id": "heading",
      "label": "Section heading",
      "default": "Compare Your Options"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "info": "Optional descriptive text below the heading"
    },
    {
      "type": "checkbox",
      "id": "full-width-enabled",
      "label": "Full width section",
      "default": false
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "comparison-gap",
      "min": 12,
      "max": 48,
      "step": 4,
      "unit": "px",
      "default": 24,
      "label": "Space between blocks"
    },
    {
      "type": "range",
      "id": "block-border-radius",
      "min": 0,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 12,
      "label": "Block corner radius"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "section-background-color",
      "label": "Section background",
      "info": "Leave empty to use theme default"
    },
    {
      "type": "color",
      "id": "color-heading",
      "label": "Heading color",
      "info": "Leave empty to use theme default"
    },
    {
      "type": "color",
      "id": "color-body-text",
      "label": "Text color",
      "info": "Leave empty to use theme default"
    },
    {
      "type": "color",
      "id": "accent-color",
      "label": "Accent color",
      "info": "Used for highlights and focus states"
    },
    {
      "type": "header",
      "content": "Section spacing"
    },
    {
      "type": "range",
      "id": "margin-top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 20,
      "unit": "px",
      "label": "Margin top"
    },
    {
      "type": "range",
      "id": "margin-bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 20,
      "unit": "px",
      "label": "Margin bottom"
    }
  ],
  "blocks": [
    {
      "type": "comparison_a",
      "name": "First Option",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Option A"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Describe the first option, its benefits, and why someone might choose this path.</p>"
        },
        {
          "type": "richtext",
          "id": "features",
          "label": "Features or bullet points",
          "default": "<ul><li>Feature one</li><li>Feature two</li><li>Feature three</li></ul>"
        },
        {
          "type": "image_picker",
          "id": "icon_image",
          "label": "Icon or image",
          "info": "Optional icon to represent this option"
        },
        {
          "type": "header",
          "content": "Block styling"
        },
        {
          "type": "color",
          "id": "block-background-color",
          "label": "Background color",
          "info": "Leave empty to use theme default"
        },
        {
          "type": "color",
          "id": "block-text-color",
          "label": "Text color",
          "info": "Leave empty to use theme default"
        }
      ]
    },
    {
      "type": "comparison_b",
      "name": "Second Option",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Option B"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Describe the second option, its benefits, and why someone might choose this alternative.</p>"
        },
        {
          "type": "richtext",
          "id": "features",
          "label": "Features or bullet points",
          "default": "<ul><li>Feature one</li><li>Feature two</li><li>Feature three</li></ul>"
        },
        {
          "type": "image_picker",
          "id": "icon_image",
          "label": "Icon or image",
          "info": "Optional icon to represent this option"
        },
        {
          "type": "header",
          "content": "Block styling"
        },
        {
          "type": "color",
          "id": "block-background-color",
          "label": "Background color",
          "info": "Leave empty to use theme default"
        },
        {
          "type": "color",
          "id": "block-text-color",
          "label": "Text color",
          "info": "Leave empty to use theme default"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Comparison Showcase",
      "blocks": [
        {
          "type": "comparison_a",
          "settings": {
            "heading": "Before",
            "description": "<p>The current situation or traditional approach with its limitations and challenges.</p>",
            "features": "<ul><li>Manual processes</li><li>Time consuming</li><li>Higher costs</li><li>Limited scalability</li></ul>"
          }
        },
        {
          "type": "comparison_b",
          "settings": {
            "heading": "After",
            "description": "<p>The improved solution with enhanced capabilities and better outcomes.</p>",
            "features": "<ul><li>Automated workflows</li><li>Fast and efficient</li><li>Cost effective</li><li>Unlimited scalability</li></ul>"
          }
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
